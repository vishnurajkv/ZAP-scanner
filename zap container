# Use Ubuntu as the base image
FROM ubuntu:latest

# Set environment variables
ENV DEBIAN_FRONTEND=noninteractive
# Use a placeholder API key that will be overridden at runtime
ENV ZAP_API_KEY=changeme
ENV ZAP_HOME=/root/.ZAP
ENV PATH="/opt/ZAP:${PATH}"

# Install dependencies including Java 17
RUN apt-get update && apt-get install -y \
    wget curl unzip ca-certificates openjdk-17-jdk \
    && rm -rf /var/lib/apt/lists/*

# Download the latest ZAP version
RUN wget https://github.com/zaproxy/zaproxy/releases/download/v2.16.1/ZAP_2.16.1_Linux.tar.gz \
    && tar -xzf ZAP_2.16.1_Linux.tar.gz -C /opt/ \
    && rm ZAP_2.16.1_Linux.tar.gz

# Find the extracted ZAP directory dynamically
RUN ZAP_DIR=$(ls -d /opt/ZAP_* | head -n 1) && \
    ln -s $ZAP_DIR /opt/ZAP

# Expose ZAP proxy port
EXPOSE 8080

# Create a start script directly in the Dockerfile to avoid the COPY issue
RUN echo '#!/bin/bash\n\
# Start ZAP with desired configuration\n\
zap.sh -daemon -host 0.0.0.0 -port 8080 -config api.disablekey=true -config api.addrs.addr.name=.* -config api.addrs.addr.regex=true\n\
# Keep container running\n\
tail -f /dev/null' > /opt/start-zap.sh && \
    chmod +x /opt/start-zap.sh

# Start ZAP and install CA certificate
CMD ["/bin/bash", "-c", "\
    $ZAP_HOME/zap.sh -daemon -port 8080 -host 0.0.0.0 && \
    sleep 10 && \
    curl -sSLk http://localhost:8080/OTHER/core/other/rootcert/ -o $ZAP_CERT_PATH && \
    cp $ZAP_CERT_PATH /usr/local/share/ca-certificates/zap_ca.crt && \
    update-ca-certificates && \
    tail -f /dev/null"]


# Start the script on container launch
ENTRYPOINT ["/opt/start-zap.sh"]




-------------



curl "http://localhost:8080/JSON/core/view/sites/"


-------------





docker stop $(docker ps -aq)
docker rm $(docker ps -aq)
docker network prune -f











docker build -t zap-ubuntu .    

docker run -d --name zap-proxy -p 8080:8080 zap-ubuntu 


 curl "http://localhost:8080/JSON/core/view/sites/"



run the zap docker 



docker build -t zap-ubuntu .   

docker run -d --name zap-proxy -p 8080:8080 zap-ubuntu



------

run the browser agent docker 



docker run -d --name testa -e HTTP_PROXY=http://host.docker.internal:8080 -e HTTPS_PROXY=http://host.docker.internal:8080 testa


docker exec -it testa bash

